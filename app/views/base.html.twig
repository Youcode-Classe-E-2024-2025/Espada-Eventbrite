<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/jpg" href="/assets/imges/espada.png">
      <head>
        <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.min.js"></script>
        <script>
            window.FontAwesomeConfig = {
                autoReplaceSvg: 'nest', 
            };
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="/assets/css/tailwind.config.js"></script>
        <link rel="stylesheet" href="public/assets/css/style.css">
        <title>{% block title %}ESPADA{% endblock %}</title>
     {% block stylesheets %} {% endblock %}
      </head>
              <body class="h-full text-base-content">
                <div id="main-container" class="bg-gray-50">
                {% block header %} {% endblock %}
                {% block content %} {% endblock %}
                {% block footer %} {% endblock %}
</div>
<script src="/assets/script/base.js"></script>
<script>

  let not =document.getElementById('notifCont');
 
    let ws;
let user_id;

ws = new WebSocket('ws://localhost:3009'); 

ws.onopen = () => {
    console.log('Connected to WebSocket server');
    user_id = {{ session.get('user').id }};  // Ensure session data is properly injected

    const registerMessage = { type: 'register', user_id: user_id };
    ws.send(JSON.stringify(registerMessage));  
};

ws.onmessage = (event) => {
    try {
        const data = JSON.parse(event.data);

        // Log only the action and event_name if they exist
        if (data.action && data.event_name) {
            console.log(`Action: ${data.action}, Event Name: ${data.event_name}`);
          let notifCont = document.getElementById('notifCont');

            // Create a new notification element
            let newNotification = `
                <div class="p-4 border-b border-gray-100 hover:bg-gray-50">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <span class="inline-block p-2 rounded-full bg-blue-100 text-blue-600">
                                <i class="fa-solid fa-ticket text-lg"></i>
                            </span>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">${data.event_name}</p>
                            <p class="text-sm text-gray-500">${data.action} - ${data.event_name}</p>
                            <p class="mt-1 text-xs text-gray-400">Just now</p>
                        </div>
                    </div>
                </div>`;

            // Append new notification at the top
            notifCont.insertAdjacentHTML('afterbegin', newNotification);
        } else {
            console.log('Received:', data);
        }
        // Display message in the messageArea
        document.getElementById('messageArea').innerText = JSON.stringify(data, null, 2);
        
    } catch (error) {
        console.error('Error parsing WebSocket message:', error);
    }
};

ws.onclose = () => {
    console.log('Disconnected from WebSocket server');
};

// Handle WebSocket errors
ws.onerror = (error) => {
    console.error('WebSocket error:', error);
};

</script>
{% block scripts %}{% endblock %}
              </body>
            </html>
          